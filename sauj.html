<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reproductor de Canales TV</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        h1 {
            color: #333;
        }
        #channels {
            margin-top: 20px;
        }
        .channel-item {
            padding: 10px;
            border: 1px solid #ccc;
            margin-bottom: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
        }
        .channel-item:hover {
            background-color: #f0f0f0;
        }
        .channel-item img {
            margin-left: 10px;
        }
        #player {
            margin-top: 20px;
            width: 100%;
            max-width: 800px;
        }
        #status {
            margin-top: 10px;
            color: #666;
        }
    </style>
</head>
<body>
    <h1>Reproductor de Canales TV</h1>
    <input type="text" id="m3u-link" placeholder="Ingrese el enlace de la lista M3U" style="width: 300px; padding: 5px;">
    <button onclick="loadM3U()">Cargar Lista</button>

    <div id="channels"></div>
    <video id="player" controls></video>
    <div id="status">Esperando lista M3U...</div>

    <!-- Incluir HLS.js -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

    <script>
        const player = document.getElementById('player');
        const channelsContainer = document.getElementById('channels');
        const status = document.getElementById('status');

        // Cargar lista M3U
        function loadM3U() {
            const m3uLink = document.getElementById('m3u-link').value;
            if (!m3uLink) {
                status.textContent = 'Por favor, ingrese un enlace vÃ¡lido.';
                return;
            }

            fetch(m3uLink)
                .then(response => response.text())
                .then(data => {
                    const channels = parseM3U(data);
                    displayChannels(channels);
                    status.textContent = `Canales cargados: ${channels.length}`;
                })
                .catch(error => {
                    status.textContent = 'Error al cargar la lista M3U.';
                    console.error(error);
                });
        }

        // Parsear lista M3U
        function parseM3U(data) {
            const lines = data.split('\n');
            const channels = [];
            let channel = {};

            lines.forEach(line => {
                if (line.startsWith('#EXTINF')) {
                    const info = line.split(',');
                    channel.name = info[1].trim();
                    channel.logo = info[0].split('tvg-logo="')[1]?.split('"')[0] || '';
                } else if (line.startsWith('http')) {
                    channel.url = line.trim();
                    channels.push(channel);
                    channel = {};
                }
            });

            // Ordenar canales por nombre
            channels.sort((a, b) => a.name.localeCompare(b.name));
            return channels;
        }

        // Mostrar canales en la lista
        function displayChannels(channels) {
            channelsContainer.innerHTML = '';
            channels.forEach(channel => {
                const channelItem = document.createElement('div');
                channelItem.className = 'channel-item';
                channelItem.innerHTML = 
                    <strong>${channel.name}</strong>
                    ${channel.logo ? <img src="${channel.logo}" alt="${channel.name}" width="50" style="margin-left: 10px;"> : ''}
                ;
                channelItem.addEventListener('click', () => playChannel(channel.url));
                channelsContainer.appendChild(channelItem);
            });
        }

        // Reproducir un canal
        function playChannel(url) {
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(player);
                hls.on(Hls.Events.MANIFEST_PARSED, function () {
                    status.textContent = 'Reproduciendo...';
                });
                hls.on(Hls.Events.ERROR, function (event, data) {
                    handleError('HLS', data);
                });
            } else if (player.canPlayType('application/vnd.apple.mpegurl')) {
                player.src = url;
                status.textContent = 'Reproduciendo...';
            } else {
                status.textContent = 'Tu navegador no soporta HLS.';
            }
        }

        // Manejo de errores
        function handleError(format, error) {
            console.error(Error en ${format}:, error);
            status.textContent = Error: No se puede reproducir el canal (${format}).;
        }
    </script>
</body>
</html>
